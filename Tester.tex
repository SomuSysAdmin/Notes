\input{format}
%	Added packages below just for the sake of autocomplete.
\usepackage{minted}
\usepackage{booktabs}

\begin{document}
	\input{"Mod3/chapters/3.19 Managing and Understanding the Boot Procedure"}
	
	\section{Managing File System mounts in a systemd Environment}
	Other than using \verb|/etc/fstab|, systemd also provides a way to mount file systems. Further, not all file systems are mounted (or available) using \verb|/etc/fstab|. The file systems that can be mounted using systemd (called \textbf{mount units}) can be obtained by:
	
	\vspace{-15pt}
	\begin{minted}{console}
	# ls *.mount
	dev-hugepages.mount            sys-kernel-config.mount
	dev-mqueue.mount               sys-kernel-debug.mount
	proc-fs-nfsd.mount             tmp.mount
	proc-sys-fs-binfmt_misc.mount  var-lib-nfs-rpc_pipefs.mount
	sys-fs-fuse-connections.mount
	\end{minted}
	\vspace{-10pt}
	
	\noindent
	These contain the specifications for certain file systems that need to be mounted at all times, such as \verb|/tmp|. The contents of \verb|tmp.mount| is:
	
	\vspace{-15pt}
	\begin{minted}{bash}
	[Unit]
	Description=Temporary Directory
	Documentation=man:hier(7)
	Documentation=http://www.freedesktop.org/wiki/Software/systemd/APIFileSystems
	ConditionPathIsSymbolicLink=!/tmp
	DefaultDependencies=no
	Conflicts=umount.target
	Before=local-fs.target umount.target
	After=swap.target
	
	[Mount]
	What=tmpfs
	Where=/tmp
	Type=tmpfs
	Options=mode=1777,strictatime
	
	# Make 'systemctl enable tmp.mount' work:
	[Install]
	WantedBy=local-fs.target
	\end{minted}
	\vspace{-10pt}
	
	\noindent
	While the unit specification is very generic, the \verb|[Mount]| and \verb|[Install]| specifications are very important. The \verb|What| defines the file system to be mounted, the \verb|Where| clause defines the location to mount the file system. The file system type is \textit{tmpfs} and there are certain mount options as well. The \textit{Install} section defines that \verb|local-fs.target| needs this mount point to work, which in turn makes it possible to mount this file system using \verb|systemctl|.
	
	If we want a custom mount file like this, we have to put it in \verb|/etc/systemd/system| directory. A bare-bones mount unit file would look like:
	
	\vspace{-15pt}
	\begin{minted}{bash}
	# Mount unit for /dev/vgPrime/lvPrime
	
	[Unit]
	Description="My test mount"
	
	[Mount]
	what=/dev/vgPrime/lvPrime
	Where=/myLv
	Type=xfs
	
	[Install]
	WantedBy=multi-user.target
	\end{minted}
	\vspace{-10pt}
	
	\noindent
	Then we mount the disk and check its status using:
	
	\vspace{-15pt}
	\begin{minted}{console}
	# systemctl start myLv.mount
	# systemctl status myLv.mount -l
	‚óè myLv.mount - "My test mount"
	Loaded: loaded (/etc/systemd/system/myLv.mount; disabled; vendor preset: disabled)
	Active: active (mounted) since Wed 2017-12-20 10:51:59 IST; 3s ago
	Where: /myLv
	What: /dev/mapper/vgPrime-lvPrime
	Process: 3510 ExecMount=/bin/mount /dev/vgPrime/lvPrime /myLv -t xfs (code=exited, status=0/SUCCESS)
	
	Dec 20 10:51:59 vmPrime.somuVMnet.com systemd[1]: Mounting "My test mount"...
	Dec 20 10:51:59 vmPrime.somuVMnet.com systemd[1]: Mounted "My test mount".
	\end{minted}
	\vspace{-10pt}
	
	\noindent
	Now, to ensure that the disk is auto-mounted when the multi-user.target is loaded, we need to add a symlink to it in the \textit{wants} directory for that target. This is achieved by:
	
	\vspace{-15pt}
	\begin{minted}{console}
	# systemctl enable myLv.mount 
	Created symlink from /etc/systemd/system/multi-user.target.wants/myLv.mount to /etc/systemd/system/myLv.mount.
	\end{minted}
	\vspace{-10pt}
	
	\noindent
	This makes sure that every time the \textit{multi-user.target} is active, the file system \textit{myLv} is auto-mounted. 
		 
\end{document}


